(()=>{var t=null,n={},e=null,o=null,a=!1,s="daughnut",c=null;function i(t){try{return t&&new URL(t).hostname||null}catch(t){return null}}function r(){c&&clearInterval(c),c=setInterval((function(){var t;a&&o&&(t=o)&&(n[t][1]=(n[t][1]||0)+1,chrome.storage.local.set({siteTimeData:n},(function(){"list"===s&&chrome.runtime.sendMessage({type:"timeUpdateList",timeData:n}).catch((function(){})),"daughnut"===s&&chrome.runtime.sendMessage({type:"timeUpdateDaughnut",timeData:n}).catch((function(){}))})))}),1e3)}function l(){c&&(clearInterval(c),c=null)}function u(t,e){n[t]?n[t][0]=e:n[t]=[e,0]}function g(t,n){var e,o;if(t)if(n)u(t,n);else{var a="https://".concat(t,"/favicon.ico");e=a,o=function(e){u(t,n=e||"assets/default-favicon.png")},fetch(e).then((function(t){t.ok?o(e):o(null)})).catch((function(){return o(null)}))}else console.error("Domain is null, skipping favicon handling.")}chrome.runtime.onMessage.addListener((function(c,u,d){return"getData"===c.type?(d({timeData:n,display:s}),!0):"startOrPause"===c.type?(a=c.status,console.log("Tracking status changed to:",a),a?chrome.tabs.query({active:!0,currentWindow:!0},(function(n){n[0]&&(t=n[0].id,o=i(n[0].url),e=n[0].favIconUrl,n[0].url.startsWith("chrome://")&&(e="assets/chrome-favicon.png"),g(o,e),r(),console.log("Started tracking for:",o))})):(l(),t=null,o=null),chrome.storage.local.set({isTracking:a}),d({status:"success"}),!0):"clear"===c.type?(n={},chrome.storage.local.set({siteTimeData:n}),console.log("Cleared time data"),d({status:"success"}),!0):"daughnut"===c.type?(s="daughnut",console.log("Displaying: ",s,"for tracking status: ",a),a?d({status:"success"}):(console.log("sending response as it is not tracking ",s),d({timeData:n,display:s})),!0):"list"===c.type?(s="list",console.log("Displaying: ",s,"for tracking status: ",a),a?d({status:"success"}):(console.log("sending response as it is not tracking ",s),d({timeData:n,display:s})),!0):void 0})),chrome.windows.onFocusChanged.addListener((function(n){a&&(n===chrome.windows.WINDOW_ID_NONE?(console.log("Window lost focus"),l()):(console.log("Window gained focus"),chrome.tabs.query({active:!0,currentWindow:!0},(function(n){n[0]&&(t=n[0].id,o=i(n[0].url),e=n[0].favIconUrl,n[0].url.startsWith("chrome://")&&(e="assets/chrome-favicon.png"),g(o,e),r(),console.log("Resumed tracking for:",o))}))))})),chrome.tabs.onActivated.addListener((function(n){a&&(l(),chrome.tabs.get(n.tabId,(function(n){t=n.id,o=i(n.url),e=n.favIconUrl,console.log("Current domain:",n.url),n.url.startsWith("chrome://")&&(e="assets/chrome-favicon.png"),g(o,e),r(),console.log("Tab activated:",o)})))})),chrome.tabs.onUpdated.addListener((function(n,s,c){a&&n===t&&s.url&&(l(),o=i(s.url),e=c.favIconUrl,c.url.startsWith("chrome://")&&(e="assets/chrome-favicon.png"),g(o,e),r(),console.log("Tab URL updated:",o))})),chrome.storage.local.get(["isTracking","siteTimeData"],(function(s){a=s.isTracking||!1,n=s.siteTimeData||{},a&&chrome.tabs.query({active:!0,currentWindow:!0},(function(n){n[0]&&(t=n[0].id,o=i(n[0].url),e=n[0].favIconUrl,n[0].url.startsWith("chrome://")&&(e="assets/chrome-favicon.png"),g(o,e),r())}))}))})();